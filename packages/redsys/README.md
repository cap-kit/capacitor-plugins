<p align="center">
  <img
    src="https://raw.githubusercontent.com/cap-kit/capacitor-plugins/main/assets/logo.png"
    alt="CapKit Logo"
    width="128"
  />
</p>

<h3 align="center">Redsys</h3>
<p align="center">
  <strong>
    <code>@cap-kit/redsys</code>
  </strong>
</p>

<p align="center">
  The <strong>Redsys InApp SDK bridge</strong> for the Cap-Kit ecosystem.<br>
  This package provides a unified, production-ready Capacitor interface for Redsys payments on iOS and Android.<br>
  It supports both <strong>Direct Payment</strong> and <strong>WebView (3DS) Payment</strong> flows with a consistent cross-platform API.<br>
  <em>Note:</em> This plugin requires official Redsys InApp SDK credentials and configuration.
</p>

<p align="center">
  <a href="https://www.npmjs.com/package/@cap-kit/redsys">
    <img src="https://img.shields.io/npm/v/@cap-kit/redsys?color=blue&label=npm&logo=npm&style=flat-square" alt="npm version">
  </a>
  <a href="https://github.com/cap-kit/capacitor-plugins/actions">
    <img src="https://img.shields.io/github/actions/workflow/status/cap-kit/capacitor-plugins/ci.yml?branch=main&label=CI&logo=github&style=flat-square" alt="CI Status" />
  </a>
  <a href="https://capacitorjs.com/">
    <img src="https://img.shields.io/badge/Capacitor-Plugin-blue?logo=capacitor&style=flat-square" alt="Capacitor Plugin">
  </a>
  <a href="https://www.npmjs.com/package/@cap-kit/redsys">
    <img src="https://img.shields.io/npm/dm/@cap-kit/redsys?style=flat-square" alt="Downloads" />
  </a>
  <a href="./LICENSE">
    <img src="https://img.shields.io/npm/l/@cap-kit/redsys?style=flat-square&logo=open-source-initiative&logoColor=white&color=green" alt="License" />
  </a>
  <img src="https://img.shields.io/maintenance/yes/2026?style=flat-square" alt="Maintained" />
</p>
<br>

---

## Overview

`@cap-kit/redsys` is a Capacitor v8 plugin that bridges the official Redsys InApp SDK for iOS and Android.

It provides:

- A **platform-agnostic JavaScript API**
- Native SDK orchestration
- Unified response structure across platforms
- Standardized error handling
- Built-in HMAC signature utilities
- Optional UI customization via `capacitor.config.ts`

The plugin follows a strict layered architecture:

- **Bridge Layer** ‚Üí Handles Capacitor calls
- **Implementation Layer** ‚Üí Orchestrates native SDK
- **Utils Layer** ‚Üí Mapping & crypto utilities
- **Config Layer** ‚Üí Immutable runtime configuration

---

## Supported Flows

### Direct Payment

Fully native card entry flow handled by the Redsys SDK.

```ts
await Redsys.doDirectPayment({
  order: 'ORDER123',
  amount: 25.5,
  transactionType: 'normal',
});
```

---

## Installation

```bash
pnpm add @cap-kit/redsys
# or
npm install @cap-kit/redsys
# or
yarn add @cap-kit/redsys
# then run:
npx cap sync
```

---

## Native SDK Distribution & Setup

For licensing and compliance reasons, the Redsys SDK binaries are not bundled with this package. You must obtain the official binaries and use the provided orchestrator script to configure your native projects.

### 1. Prepare the Binaries

Create a folder named `sdks/` in your project root (next to `package.json`) and place the official files inside:

- **Android**: `redsys-sdk-inApp-2.4.5.aar` (Download from [Redsys Portal](https://pagosonline.redsys.es/desarrolladores-inicio/integrate-con-nosotros/area-de-descargas-y-documentacion/))
- **iOS**: `TPVVInLibrary.xcframework` (Download from the same portal)

### 2. Run the Orchestrator Script

Execute the following command to distribute the SDKs to the persistent native directories:

```bash
npm run setup-redsys-sdk

```

This script performs two critical actions:

- **Android**: Generates a persistent local Maven repository in `android/app/libs/`.
- **iOS**: Moves the framework to `ios/App/` for manual embedding.

---

### Platform Specific Configuration

#### ü§ñ Android

Update your Gradle files to recognize the persistent repository generated by the script:

**`android/build.gradle` (Project Root):**

```gradle
allprojects {
    repositories {
        // ... other repos
        maven { url "${rootProject.projectDir}/app/libs" }
    }
}

```

**`android/app/build.gradle` (App Module):**

```gradle
dependencies {
    implementation project(':cap-kit-redsys')
    // This resolves the dependency from your persistent local libs folder
    implementation "com.redsys.tpvvinapplibrary:redsys-sdk-inApp:2.4.5"
}

```

#### üçé iOS (Xcode 26)

1. **Add to Project**: Open Xcode, right-click the **App** folder, select **Add Files to "App"...**, and choose `ios/App/TPVVInLibrary.xcframework`.
2. **Embedding**: In your App Target settings (**General** tab), find **Frameworks, Libraries, and Embedded Content** and ensure the SDK is set to **Embed & Sign**.

---

### Final Directory Structure

After running the script, your project will follow this professional persistent layout:

```text
my-capacitor-app/
‚îú‚îÄ‚îÄ sdks/                          <-- Your Source Binaries
‚îÇ   ‚îú‚îÄ‚îÄ redsys-sdk-inApp-2.4.5.aar
‚îÇ   ‚îî‚îÄ‚îÄ TPVVInLibrary.xcframework
‚îú‚îÄ‚îÄ android/
‚îÇ   ‚îî‚îÄ‚îÄ app/
‚îÇ       ‚îî‚îÄ‚îÄ libs/                  <-- Generated Persistent Maven Repo
‚îÇ           ‚îî‚îÄ‚îÄ com/redsys/tpvvinapplibrary/redsys-sdk-inApp/
‚îÇ               ‚îú‚îÄ‚îÄ maven-metadata.xml
‚îÇ               ‚îî‚îÄ‚îÄ 2.4.5/
‚îÇ                   ‚îú‚îÄ‚îÄ redsys-sdk-inApp-2.4.5.aar
‚îÇ                   ‚îî‚îÄ‚îÄ redsys-sdk-inApp-2.4.5.pom
‚îî‚îÄ‚îÄ ios/
    ‚îî‚îÄ‚îÄ App/
        ‚îî‚îÄ‚îÄ TPVVInLibrary.xcframework <-- Persistent Binary

```

---

## Web Payment Workflow (3-D Secure)

The WebView payment flow requires a server-side signature to ensure transaction integrity. The process follows these steps:

1. **Initialize**: Call `initializeWebPayment()` to get the `base64Data`.
2. **Sign**: Send `base64Data` to your backend. Your server signs it using your **Merchant Secret Key**.
3. **Process**: Call `processWebPayment({ signature: '...' })` with the signature from your server.

### Signature Generation (HMAC)

The signature must be an **HMAC-SHA256** (or SHA512) hash.

#### ‚ö†Ô∏è Security Warning

**Never store your Merchant Secret Key inside the mobile application.** Doing so exposes your credentials to decompilation. Always generate signatures on a secure backend.

#### Using `computeHash` (Testing Only)

For development and rapid prototyping, the plugin provides a native helper to generate signatures locally:

```ts
import { Redsys, RedsysTransactionType } from '@cap-kit/redsys';

// 1. Get transaction data
const { base64Data } = await Redsys.initializeWebPayment({
  order: 'ORDER123',
  amount: 25.5,
  transactionType: RedsysTransactionType.Normal,
});

// 2. Generate hash locally (ONLY FOR TESTING)
const { signature } = await Redsys.computeHash({
  data: base64Data,
  keyBase64: 'YOUR_TEST_SECRET_KEY', // Base64 encoded key
  algorithm: 'HMAC_SHA256_V1',
});

// 3. Open the secure WebView
const result = await Redsys.processWebPayment({ signature });
```

#### Production Implementation (Recommended)

In production, your backend should perform the signature calculation following the official Redsys logic:

1. Base64 decode your Merchant Key.
2. Generate a derived key using **3DES** with the `order` number.
3. Compute the **HMAC-SHA256** of the `base64Data` using that derived key.
4. Base64 encode the final result.

---

## Configuration

<docgen-config>
<!--Update the source file JSDoc comments and rerun docgen to update the docs below-->

Configuration options for the Redsys plugin.

| Prop                           | Type                                                                    | Description                                                                                                                                                                                               | Default            | Since |
| ------------------------------ | ----------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ | ----- |
| **`verboseLogging`**           | <code>boolean</code>                                                    | Enables verbose native logging. When enabled, additional debug information is printed to the native console (Logcat on Android, Xcode on iOS).                                                            | <code>false</code> | 8.0.0 |
| **`signature`**                | <code>string</code>                                                     | Optional global merchant signature for web payments. If provided, it acts as a default when not passed in the method call.                                                                                |                    | 8.0.0 |
| **`license`**                  | <code>string</code>                                                     | Application license. Alphanumeric code provided by Redsys to validate the application.                                                                                                                    |                    | 8.0.0 |
| **`environment`**              | <code>RedsysEnvironment</code>                                          | Transaction environment. Maps to ENVIRONMENT_TEST/REAL (Android) or EnviromentType (iOS).                                                                                                                 |                    | 8.0.0 |
| **`fuc`**                      | <code>string</code>                                                     | Merchant identification code (FUC).                                                                                                                                                                       |                    | 8.0.0 |
| **`terminal`**                 | <code>string</code>                                                     | Terminal identifier associated with the merchant.                                                                                                                                                         |                    | 8.0.0 |
| **`currency`**                 | <code>string</code>                                                     | ISO-4217 currency code. Default is "978" (EUR).                                                                                                                                                           |                    | 8.0.0 |
| **`merchantName`**             | <code>string</code>                                                     | Name of the payment titular.                                                                                                                                                                              |                    |       |
| **`merchantUrl`**              | <code>string</code>                                                     | URL of the commerce.                                                                                                                                                                                      |                    | 8.0.0 |
| **`merchantData`**             | <code>string</code>                                                     | Additional merchant data (internal references, etc.).                                                                                                                                                     |                    | 8.0.0 |
| **`merchantDescription`**      | <code>string</code>                                                     | Commerce descriptor or description.                                                                                                                                                                       |                    | 8.0.0 |
| **`merchantGroup`**            | <code>string</code>                                                     | FUC of the merchant group for inter-merchant references.                                                                                                                                                  |                    | 8.0.0 |
| **`merchantConsumerLanguage`** | <code>RedsysLanguage</code>                                             | Global merchant language setting. Maps to TPVVConfiguration.setLanguage (Android) or appMerchantConsumerLanguage (iOS).                                                                                   |                    | 8.0.0 |
| **`transactionType`**          | <code><a href="#redsystransactiontype">RedsysTransactionType</a></code> | Default transaction type for the application. Maps to TransactionType constants.                                                                                                                          |                    | 8.0.0 |
| **`paymentMethods`**           | <code>RedsysPaymentMethod[]</code>                                      | Payment method(s) to be displayed in WebView flow.                                                                                                                                                        |                    | 8.0.0 |
| **`enableRedirection`**        | <code>boolean</code>                                                    | Enables automatic redirection to the bank's 3DS page when required. If false, the plugin will return a specific error code for 3DS requirements, allowing the application to handle redirection manually. | <code>true</code>  | 8.0.0 |
| **`enableResultAlert`**        | <code>boolean</code>                                                    | Enables display of result alerts after payment completion. If false, the plugin will return the result data without showing native alerts, allowing the application to handle result presentation.        | <code>true</code>  | 8.0.0 |
| **`ui`**                       | <code><a href="#redsysuioptions">RedsysUIOptions</a></code>             | Native UI customization options.                                                                                                                                                                          |                    | 8.0.0 |

### Examples

In `capacitor.config.json`:

```json
{
  "plugins": {
    "Redsys": {
      "verboseLogging": true,
      "license": "your_license_here",
      "environment": "RedsysEnvironment.Test",
      "fuc": "XXXXXXXXXXX",
      "terminal": "XX",
      "currency": "978",
      "merchantUrl": "XXX",
      "merchantData": "XXX",
      "merchantDescription": "XXX",
      "merchantGroup": "XXX",
      "paymentMethods": "XXX",
      "enableRedirection": true,
      "enableResultAlert": true,
      "ui": {}
    }
  }
}
```

In `capacitor.config.ts`:

```ts
/// <reference types="@cap-kit/redsys" />

import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  plugins: {
    Redsys: {
      verboseLogging: true,
      license: 'your_license_here',
      environment: 'RedsysEnvironment.Test',
      fuc: 'XXXXXXXXXXX',
      terminal: 'XX',
      currency: '978',
      merchantUrl: 'XXX',
      merchantData: 'XXX',
      merchantDescription: 'XXX',
      merchantGroup: 'XXX',
      paymentMethods: 'XXX',
      enableRedirection: true,
      enableResultAlert: true,
      ui: {},
    },
  },
};

export default config;
```

</docgen-config>

---

## UI Customization: Logo & Assets

The `logo` property in `capacitor.config.ts` allows you to brand the native payment interface. Since logos cannot be passed as remote URLs for security and performance reasons, you must provide them as **native assets**.

#### 1. Define the logo name

In your `capacitor.config.ts`, set the `logo` property to the resource name (without extension):

```ts
Redsys: {
  ui: {
    logo: 'logo_merchant',
    // ...
  }
}
```

#### 2. Add the assets to Native Projects

**ü§ñ Android Implementation:**

- Place your image (e.g., `logo_merchant.png`) in the `android/app/src/main/res/drawable/` folder.
- Use lowercase letters and underscores only (e.g., `logo_merchant`).

**üçé iOS Implementation:**

- Open your project in Xcode and navigate to `App/App/Assets`.
- Create a new **Image Set** named exactly `logo_merchant`.
- Provide the @1x, @2x, and @3x versions of your logo.

> **Tip:** Use a PNG with a transparent background for the best visual result on the Redsys payment screen.

---

## API

<docgen-index>

- [`doDirectPayment(...)`](#dodirectpayment)
- [`initializeWebPayment(...)`](#initializewebpayment)
- [`processWebPayment(...)`](#processwebpayment)
- [`computeHash(...)`](#computehash)
- [`getPluginVersion()`](#getpluginversion)
- [Interfaces](#interfaces)
- [Enums](#enums)

</docgen-index>

<docgen-api>
<!--Update the source file JSDoc comments and rerun docgen to update the docs below-->

Public JavaScript API for the Redsys Capacitor plugin.

This interface defines a stable, platform-agnostic API.
All methods behave consistently across Android, iOS, and Web.

### doDirectPayment(...)

```typescript
doDirectPayment(options: RedsysPaymentRequest) => Promise<RedsysPaymentResponseOK>
```

Executes a direct payment (Native SDK UI). No 3DS support.

| Param         | Type                                                                  |
| ------------- | --------------------------------------------------------------------- |
| **`options`** | <code><a href="#redsyspaymentrequest">RedsysPaymentRequest</a></code> |

**Returns:** <code>Promise&lt;<a href="#redsyspaymentresponseok">RedsysPaymentResponseOK</a>&gt;</code>

**Since:** 8.0.0

#### Example

```ts
const result = await Redsys.doDirectPayment({
  order: '12345',
  amount: 1000,
  transactionType: RedsysTransactionType.Normal,
  description: 'Test Product',
  identifier: 'REQUEST_REFERENCE',
  extraParams: { customKey: 'customValue' },
  uiOptions: { confirmButtonText: 'Pay Now' },
});
```

---

### initializeWebPayment(...)

```typescript
initializeWebPayment(options: RedsysPaymentRequest) => Promise<RedsysWebPaymentInitResult>
```

Web Payment: Initializes and returns Base64 data for signing.

| Param         | Type                                                                  |
| ------------- | --------------------------------------------------------------------- |
| **`options`** | <code><a href="#redsyspaymentrequest">RedsysPaymentRequest</a></code> |

**Returns:** <code>Promise&lt;<a href="#redsyswebpaymentinitresult">RedsysWebPaymentInitResult</a>&gt;</code>

**Since:** 8.0.0

#### Example

```ts
const initResult = await Redsys.initializeWebPayment({
  order: '12345',
  amount: 1000,
  transactionType: RedsysTransactionType.Normal,
  description: 'Test Product',
  identifier: 'REQUEST_REFERENCE',
  extraParams: { customKey: 'customValue' },
  uiOptions: { confirmButtonText: 'Pay Now' },
});
```

---

### processWebPayment(...)

```typescript
processWebPayment(options: RedsysWebPaymentOptions) => Promise<RedsysPaymentResponseOK>
```

Web Payment: Executes WebView flow with the server-generated signature.

| Param         | Type                                                                        |
| ------------- | --------------------------------------------------------------------------- |
| **`options`** | <code><a href="#redsyswebpaymentoptions">RedsysWebPaymentOptions</a></code> |

**Returns:** <code>Promise&lt;<a href="#redsyspaymentresponseok">RedsysPaymentResponseOK</a>&gt;</code>

**Since:** 8.0.0

#### Example

```ts
const result = await Redsys.processWebPayment({
  signature: 'base64-encoded-signature',
});
```

---

### computeHash(...)

```typescript
computeHash(options: HashOptions) => Promise<HashResult>
```

| Param         | Type                                                |
| ------------- | --------------------------------------------------- |
| **`options`** | <code><a href="#hashoptions">HashOptions</a></code> |

**Returns:** <code>Promise&lt;<a href="#hashresult">HashResult</a>&gt;</code>

**Since:** 8.0.0

#### Example

```ts

```

---

### getPluginVersion()

```typescript
getPluginVersion() => Promise<PluginVersionResult>
```

Returns the native plugin version.

The returned version corresponds to the native implementation
bundled with the application.

**Returns:** <code>Promise&lt;<a href="#pluginversionresult">PluginVersionResult</a>&gt;</code>

**Since:** 8.0.0

#### Example

```ts
const { version } = await Redsys.getPluginVersion();
```

---

### Interfaces

#### RedsysPaymentResponseOK

Standardized success response object for Redsys operations.
This interface merges data from Android's ResultResponse and iOS's WebViewPaymentResponseOK.

| Prop                     | Type                                      | Description                          |
| ------------------------ | ----------------------------------------- | ------------------------------------ |
| **`code`**               | <code>number</code>                       | Internal SDK result code             |
| **`desc`**               | <code>string</code>                       | Human-readable description           |
| **`amount`**             | <code>string</code>                       | Transaction amount                   |
| **`currency`**           | <code>string</code>                       | Currency code (ISO-4217)             |
| **`order`**              | <code>string</code>                       | Order identifier                     |
| **`merchantCode`**       | <code>string</code>                       | Merchant FUC code                    |
| **`terminal`**           | <code>string</code>                       | Terminal identifier                  |
| **`responseCode`**       | <code>string</code>                       | TPV response code                    |
| **`authorisationCode`**  | <code>string</code>                       | Authorization code                   |
| **`transactionType`**    | <code>string</code>                       | Transaction type                     |
| **`securePayment`**      | <code>string</code>                       | Indicates secure payment (1/0)       |
| **`signature`**          | <code>string</code>                       | Digital signature                    |
| **`cardNumber`**         | <code>string</code>                       | Masked card number                   |
| **`cardBrand`**          | <code>string</code>                       | Card brand (e.g. VISA)               |
| **`cardCountry`**        | <code>string</code>                       | Card issuing country                 |
| **`cardType`**           | <code>string</code>                       | Card type (D/C)                      |
| **`expiryDate`**         | <code>string</code>                       | Expiry date (MMYY)                   |
| **`merchantIdentifier`** | <code>string</code>                       | Recurring / reference identifier     |
| **`consumerLanguage`**   | <code>string</code>                       | Consumer language code               |
| **`date`**               | <code>string</code>                       | Operation date (WebView only)        |
| **`hour`**               | <code>string</code>                       | Operation hour (WebView only)        |
| **`merchantData`**       | <code>string</code>                       | Merchant-specific data               |
| **`extraParams`**        | <code>Record&lt;string, string&gt;</code> | Extra parameters returned by backend |

#### RedsysPaymentRequest

| Prop                  | Type                                                                    | Description                                                                                    |
| --------------------- | ----------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| **`order`**           | <code>string</code>                                                     | Unique merchant order identifier.                                                              |
| **`amount`**          | <code>number</code>                                                     | Amount in the smallest currency unit.                                                          |
| **`description`**     | <code>string</code>                                                     | Optional product description for display in the payment UI.                                    |
| **`transactionType`** | <code><a href="#redsystransactiontype">RedsysTransactionType</a></code> | ISO-4217 currency code (e.g., "978" for EUR).                                                  |
| **`identifier`**      | <code>string</code>                                                     | Token handling: undefined (normal), 'REQUEST_REFERENCE' (new token), or existing token string. |
| **`extraParams`**     | <code>Record&lt;string, string&gt;</code>                               | Optional additional parameters to be sent to the backend and returned in the response.         |
| **`uiOptions`**       | <code><a href="#redsysuioptions">RedsysUIOptions</a></code>             | Runtime UI overrides for this specific transaction.                                            |

#### RedsysUIOptions

Abstract, platform-agnostic UI customization options for Redsys payment screens.
Some properties may only be supported on specific platforms due to SDK limitations.

| Prop                                 | Type                | Description                                                                                 |
| ------------------------------------ | ------------------- | ------------------------------------------------------------------------------------------- |
| **`logo`**                           | <code>string</code> | Top logo image reference. (Supported: Android & iOS)                                        |
| **`backgroundColor`**                | <code>string</code> | Payment screen background color (Hex string). (Supported: Android & iOS)                    |
| **`iosBackgroundImage`**             | <code>string</code> | Payment screen background image. (Supported: iOS Only)                                      |
| **`androidProgressBarColor`**        | <code>string</code> | Color of the progress bar during network operations. (Supported: Android Only)              |
| **`androidTopBarColor`**             | <code>string</code> | Background color of the top action bar. (Supported: Android Only)                           |
| **`confirmButtonText`**              | <code>string</code> | Text for the main action/payment button. (Supported: Android & iOS)                         |
| **`androidConfirmButtonColor`**      | <code>string</code> | Background color of the main action button. (Supported: Android Only)                       |
| **`androidConfirmButtonTextColor`**  | <code>string</code> | Text color of the main action button. (Supported: Android Only)                             |
| **`iosCancelButtonText`**            | <code>string</code> | Text for the cancel/back button. (Supported: iOS Only)                                      |
| **`cardNumberLabel`**                | <code>string</code> | Label text for the card number field. (Supported: Android & iOS)                            |
| **`expirationLabel`**                | <code>string</code> | Label text for the expiration date field. (Supported: Android & iOS)                        |
| **`cvvLabel`**                       | <code>string</code> | Label text for the CVV/security code field. (Supported: Android & iOS)                      |
| **`infoLabel`**                      | <code>string</code> | Descriptive text or payment instructions displayed on screen. (Supported: Android & iOS)    |
| **`labelTextColor`**                 | <code>string</code> | Text color for general labels (Card Number, Expiry, CVV). (Supported: Android & iOS)        |
| **`androidExpirationErrorText`**     | <code>string</code> | Error message text displayed when the expiration date is invalid. (Supported: Android Only) |
| **`androidCvvErrorText`**            | <code>string</code> | Error message text displayed when the CVV is invalid. (Supported: Android Only)             |
| **`cardHeaderBackgroundColor`**      | <code>string</code> | Background color of the card header area. (Supported: Android Only)                         |
| **`androidCardHeaderText`**          | <code>string</code> | Text for the card header. (Supported: Android Only)                                         |
| **`androidCardHeaderTextColor`**     | <code>string</code> | Text color for the card header. (Supported: Android Only)                                   |
| **`androidResultAlertTextOk`**       | <code>string</code> | Custom text for the success alert message. (Supported: Android Only)                        |
| **`androidResultAlertTextKo`**       | <code>string</code> | Custom text for the error alert message. (Supported: Android Only)                          |
| **`androidResultAlertButtonTextOk`** | <code>string</code> | Custom text for the success alert button. (Supported: Android Only)                         |
| **`androidResultAlertButtonTextKo`** | <code>string</code> | Custom text for the error alert button. (Supported: Android Only)                           |

#### RedsysWebPaymentInitResult

| Prop             | Type                | Description                                                     |
| ---------------- | ------------------- | --------------------------------------------------------------- |
| **`base64Data`** | <code>string</code> | Base64 data from native SDK that must be signed by the backend. |
| **`signature`**  | <code>string</code> | The signature if pre-calculated or available from config.       |

#### RedsysWebPaymentOptions

| Prop                   | Type                                              | Description                                                                                                     |
| ---------------------- | ------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| **`signature`**        | <code>string</code>                               | Server-generated signature. If omitted, the plugin will attempt to use the 'signature' defined in RedsysConfig. |
| **`signatureVersion`** | <code>'HMAC_SHA256_V1' \| 'HMAC_SHA512_V1'</code> | Defaults to HMAC_SHA256_V1 if omitted.                                                                          |

#### HashResult

| Prop            | Type                | Description              |
| --------------- | ------------------- | ------------------------ |
| **`signature`** | <code>string</code> | Firma generata in Base64 |

#### HashOptions

| Prop            | Type                                              | Description                                                                      |
| --------------- | ------------------------------------------------- | -------------------------------------------------------------------------------- |
| **`data`**      | <code>string</code>                               | Dati da firmare (solitamente la stringa Base64 ricevuta da initializeWebPayment) |
| **`keyBase64`** | <code>string</code>                               | Chiave segreta in formato Base64                                                 |
| **`algorithm`** | <code>'HMAC_SHA256_V1' \| 'HMAC_SHA512_V1'</code> | Algorithm: 'HMAC_SHA256_V1' \| 'HMAC_SHA512_V1'                                  |

#### PluginVersionResult

Result object returned by the `getPluginVersion()` method.

| Prop          | Type                | Description                       |
| ------------- | ------------------- | --------------------------------- |
| **`version`** | <code>string</code> | The native plugin version string. |

### Enums

#### RedsysTransactionType

| Members                | Value                                    | Description                         |
| ---------------------- | ---------------------------------------- | ----------------------------------- |
| **`Normal`**           | <code>'normal'</code>                    | Normal payment (Standard)           |
| **`Preauthorization`** | <code>'preauthorization'</code>          | Pre-authorization for later capture |
| **`Traditional`**      | <code>'traditional'</code>               | Traditional transaction flow        |
| **`Authentication`**   | <code>'paymentTypeAuthentication'</code> | Authentication-only flow            |

</docgen-api>

---

## Error Handling

The plugin uses standardized error codes across platforms:

| Code                | Description                         |
| ------------------- | ----------------------------------- |
| `UNAVAILABLE`       | Native SDK unavailable              |
| `PERMISSION_DENIED` | Required permission missing         |
| `INIT_FAILED`       | SDK initialization failure          |
| `UNKNOWN_TYPE`      | Invalid transaction type            |
| `CRYPTO_ERROR`      | Signature computation failure       |
| `SDK_ERROR`         | Native Redsys SDK returned an error |

SDK errors include additional metadata when available.

---

## Response Structure

All successful payment responses return a normalized structure:

```ts
{
  code: number,
  amount: string,
  currency: string,
  order: string,
  merchantCode: string,
  terminal: string,
  responseCode: string,
  authorisationCode: string,
  transactionType: string,
  securePayment: string,
  signature: string,
  cardNumber: string,
  cardBrand: string,
  cardCountry: string,
  cardType: string,
  expiryDate: string,
  merchantIdentifier: string,
  consumerLanguage: string,
  date: string,
  hour: string,
  merchantData: string
}
```

Card numbers are automatically masked before being returned to JavaScript.

---

## Security Notes

- The plugin never exposes full card numbers.
- HMAC signature computation is performed natively.
- Sensitive configuration should never be hardcoded in production builds.
- Always validate server-side responses before fulfilling orders.

---

## Platform Requirements

- Capacitor v8
- iOS: Xcode 26 (Swift Package Manager)
- Android: Manual integration of Redsys InApp SDK 2.4.5 via local Maven repository (persistent)

---

## Contributing

Contributions are welcome! Please read the [contributing guide](CONTRIBUTING.md) before submitting a pull request.

---

## Legal Notice

The Redsys SDK is developed and owned by Redsys Servicios de Procesamiento S.L.

This plugin does not modify the original SDK and only provides integration and distribution mechanisms.

### Official Documentation

For technical details on the underlying native SDKs, refer to the official guides:

- ü§ñ [In-App Integration for Android devices](https://pagosonline.redsys.es/desarrolladores-inicio/documentacion-operativa/integracion-inapp-para-dispositivos-android/)
- üçé [In-App Integration for iOS devices](https://pagosonline.redsys.es/desarrolladores-inicio/documentacion-operativa/integracion-inapp-para-dispositivos-ios/)

Official portal: https://pagosonline.redsys.es/

---

## License

MIT
